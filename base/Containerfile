FROM quay.io/fedora-ostree-desktops/sway-atomic:41

RUN set -ex \
    && ZELLIJ_LATEST=$(curl -s https://api.github.com/repos/zellij-org/zellij/releases/latest | grep "tag_name" | cut -d '"' -f 4) \
    && wget -q "https://github.com/zellij-org/zellij/releases/download/${ZELLIJ_LATEST}/zellij-x86_64-unknown-linux-musl.tar.gz" \
    && mkdir -p /tmp/zellij \
    && tar -xzf zellij-x86_64-unknown-linux-musl.tar.gz -C /tmp/zellij \
    && cp /tmp/zellij/zellij /usr/bin/ \
    && rm zellij-x86_64-unknown-linux-musl.tar.gz

RUN wget https://github.com/neovim/neovim/releases/download/v0.11.0/nvim-linux-x86_64.tar.gz \
    && mkdir -p /var/opt/nvim \
    && tar xzf nvim-linux-x86_64.tar.gz --strip-components=1 -C /var/opt/nvim \
    && rm nvim-linux-x86_64.tar.gz

COPY ./yum.repos.d/*.repo /etc/yum.repos.d/

RUN rpm-ostree override remove firefox firefox-langpacks && \
    rpm-ostree install \
    tailscale alacritty zsh && \
    rpm-ostree cleanup -m && \
    ostree container commit

