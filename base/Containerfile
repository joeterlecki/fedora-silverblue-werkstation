FROM busybox AS zellij
ARG ZELLIJ_URL="https://github.com/zellij-org/zellij/releases/download/v0.42.1/zellij-x86_64-unknown-linux-musl.tar.gz"

RUN wget -q ${ZELLIJ_URL} -O ./zellij.tar.gz && \
    tar -xzf ./zellij.tar.gz

FROM quay.io/fedora-ostree-desktops/sway-atomic:41 as release

LABEL name="$NAME" \
    summary="Fedora Silverblue SWAY Base container" \
    maintainer="Joe Terlecki"

ARG WEZTERM_URL="https://github.com/wezterm/wezterm/releases/download/20240203-110809-5046fc22/wezterm-20240203_110809_5046fc22-1.fedora39.x86_64.rpm"

RUN echo "net.ipv4.ip_forward=1" > /etc/sysctl.d/99-ip-forward.conf && \
    echo "net.ipv6.conf.all.forwarding=1" >> /etc/sysctl.d/99-ip-forward.conf

COPY --from=zellij /zellij /usr/local/bin/
COPY ./yum.repos.d/*.repo /etc/yum.repos.d/

RUN rpm-ostree override remove firefox firefox-langpacks \
    && rpm-ostree install \
    tailscale \
    zsh \
    ${WEZTERM_URL} \
    && rpm-ostree cleanup -m \
    && ostree container commit
